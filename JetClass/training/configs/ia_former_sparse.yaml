seed_everything: 42
trainer:
  max_epochs: 20
  accelerator: "gpu"
  devices: -1
  strategy: "auto"  # Changed: removed find_unused_parameters (5-10% speedup)
  precision: "bf16-mixed"
  accumulate_grad_batches: 2
  
  # Gradient clipping for stability
  gradient_clip_val: 1.0
  gradient_clip_algorithm: "norm"
  
  # Disable validation sanity check (saves time at start)
  num_sanity_val_steps: 0
  
  # Optimized logging
  log_every_n_steps: 50
  
  # Enable benchmarking for consistent input sizes
  benchmark: true  # 5-15% speedup for fixed input sizes
  
  # Limit val batches for faster validation (optional)
  # limit_val_batches: 0.5  # Use only 50% of val set
  
  callbacks:
    - class_path: lightning.pytorch.callbacks.ModelCheckpoint
      init_args:
        save_weights_only: true
        mode: "min"
        monitor: "val_loss"
        every_n_train_steps: 0
        every_n_epochs: 1
        train_time_interval: null
        save_top_k: 2
        
    - class_path: lightning.pytorch.callbacks.EarlyStopping
      init_args:
        monitor: "val_loss"
        min_delta: 0.0
        patience: 5
        verbose: false
        
  logger:
    - class_path: lightning.pytorch.loggers.WandbLogger
      init_args:
        project: "jetclass"
        name: "ia_former_sparse_optimized"
        save_dir: "."
        log_model: false

model:
  class_path: models.models_sparse.HybridJetTaggingModule
  init_args:
    in_channels: 11
    u_channels: 6
    embed_dim: 64
    attn: "diff"
    num_blocks: 16
    num_heads: 16
    num_classes: 10
    lr: 1e-3
    t_max: 5
    eta_min: 1e-4
    batch_size: 256
    compile_model: false
    sparse: true  # Use sparse PyG representation

data:
  class_path: data.data_handling_sparse.JetClassLightningDataModule
  init_args:
    train_files: "/mnt/d/waleed/CP-Higgs/JetClass/train_00.h5"
    val_files: "/mnt/d/waleed/CP-Higgs/JetClass/train_00.h5"
    test_files: "/mnt/d/waleed/CP-Higgs/JetClass/train_00.h5"
    batch_size: 256
    num_workers: 12
    pin_memory: true
    persistent_workers: true
    prefetch_factor: 4
    filter_zero_edges: true
    dataset_class: "spase"   # or "dense"

